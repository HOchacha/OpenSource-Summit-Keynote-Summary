# Host Kernel Qualification for Cloud Computing at Scale - Fiona Meichen Liu, Google

다중 선택: OSS 2023 JN

## 1. 발표자 & 배경

- **발표자**: Fiona, Google Cloud Compute Engine 팀 소프트웨어 엔지니어
- **역할**: 호스트머신의 Linux 커널을 포함한 호스트 소프트웨어 자격(qualification) 및 배포 담당

## 2. 클라우드·가상화 개요

- **클라우드 컴퓨팅**: 인프라·스토리지 등을 인터넷 상에서 서비스 형태로 제공
- **가상화**
    - **Hypervisor (KVM)**: 물리 머신 자원을 여러 VM에 할당
    - **VMM**: KVM 모듈과 연동해 CPU/메모리 등 에뮬레이션

## 3. 커널 자격(qualification) 파이프라인

1. **소스 머지 & 유닛 테스트**
    - Google-forked Linux + 수만개 패치 → 개발자 단위 유닛 테스트
2. **스모크 테스트**
    - VM 기동·마이그레이션·네트워크 연결 등 “최소 기능” 검증
    - 호스트 크래시 시 자동 격리 → 디버깅·수리
3. **격리된 테스트베드**
    - 특정 호스트·소프트웨어 조합에서 기능·성능 교차 검증
4. **확장된 테스트베드**
    - 프로덕션급 환경과 유사한 다양한 호스트에 설치
    - 다른 팀(네트워크·VMM·애플리케이션 팀)의 테스트와 크로스 테스트
    - 업그레이드·다운그레이드 경로 검증
5. **프로그레스 단계별 롤아웃**
    - 기능 → 기본 성능 → 대규모 워크로드 스트레스 테스트 → 프로덕션

## 4. 성능 자격: 벤치마크·워크로드

- **VM 패밀리별 최적화**: 범용·컴퓨트·메모리 최적화 등
- **대표 벤치마크**:
    - SPEC CPU (speed, rate)
    - netperf (네트워크)
    - redis-benchmark (KV DB)
    - PerfKit Benchmarker: 위 툴 래핑, 대규모 클라우드 워크로드 시뮬레이션
- **장시간 스트레스**:
    - 지속적 벤치마크 → 드물게 발생하는 성능 저하 포착
- **메트릭 수집**:
    - **호스트 레벨**: CPU/메모리/Disk/네트워크 활용률, 프로세스 크래시 등
    - **게스트 레벨**: Cloud Ops Agent(OpenTelemetry) 통해 VM 내부 지연·리소스 지표, 애플리케이션 메트릭

## 5. 대규모 환경의 도전 과제

1. **Noisy Neighbor**
    - 동일 호스트 내 과도한 워크로드 간 리소스 경쟁
    - **해결책**: 싱글테넌트 VM, 성능 저하 시 VM 마이그레이션, 자원 할당 한도 설정
2. **롤아웃·롤백 비용**
    - VM 재시작/라이브마이그레이션 필요 → 서비스 중단 위험
    - 하드웨어별·VM패밀리별 부분 롤백·조건부 배포 체계 필요
3. **테스트 리소스 한계**
    - 희귀·고가호스트 테스트 머신 최적 분배
4. **노이즈 신호 & 오탐**
    - 환경 요인(日기기 부하 등)으로 인한 성능 변동 구분
    - 지표·알림 → 자동화된 이상 감지·트라이애징 툴 필요
5. **급속 확장하는 하드웨어·기능**
    - 자동화 인프라 투자 필요 → 수작업 최소화

## 6. 요약 및 교훈

- **종합 테스트베드**: 기능·성능·업그레이드 경로 전 단계 검증
- **대표 벤치마크·실사용 워크로드**: 실제 사용 패턴 반영한 장시간 스트레스
- **메트릭 가시화**: 호스트·게스트 모두에서 지표 수집·대시보드 모니터링
- **자동화 & 효율화**: 리소스 최적 분배, 오탐 감소, 대규모 배포·롤백 체계
- **협업 & 도메인 전문성**: 각 팀(커널·네트워크·VMM·퍼포먼스)이 유기적 협력

> 핵심: 방대한 커널·환경 변화 속에서도 안정성·성능을 보장하려면
> 
> 1. 다단계 자격 파이프라인
> 2. 실제 워크로드 기반 벤치마크
> 3. 체계적 메트릭·알림·자동화가 필수!